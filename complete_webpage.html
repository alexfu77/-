<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å›½é™…è´¸æ˜“æ•°æ®æŸ¥è¯¢ç³»ç»Ÿ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            min-height: 100vh;
            padding: 20px;
            color: #333;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            overflow: hidden;
        }

        header {
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: white;
            padding: 40px;
            text-align: center;
        }

        header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            font-weight: 700;
        }

        .subtitle {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .input-section {
            padding: 40px;
            background: #f8f9fa;
        }

        .form-group {
            margin-bottom: 25px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
        }

        .label-text {
            font-weight: 600;
            color: #555;
            font-size: 1em;
        }

        .label-hint {
            font-size: 0.85em;
            color: #888;
            margin-left: 8px;
            font-weight: normal;
        }

        .form-group input {
            width: 100%;
            padding: 14px 18px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 1em;
            transition: all 0.3s;
        }

        .form-group input:focus {
            outline: none;
            border-color: #2a5298;
            box-shadow: 0 0 0 3px rgba(42, 82, 152, 0.1);
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        button[type="submit"] {
            width: 100%;
            padding: 16px;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 1.1em;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            margin-top: 10px;
            position: relative;
        }

        button[type="submit"]:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(42, 82, 152, 0.3);
        }

        button[type="submit"]:disabled {
            opacity: 0.7;
            cursor: not-allowed;
        }

        .loader {
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-top: 3px solid white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
            display: inline-block;
            vertical-align: middle;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .info-box {
            margin-top: 30px;
            padding: 20px;
            background: white;
            border-radius: 8px;
            border-left: 4px solid #2a5298;
        }

        .info-box h3 {
            margin-bottom: 15px;
            color: #333;
        }

        .sources-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-top: 15px;
        }

        .source-category {
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
            border: 1px solid #e0e0e0;
        }

        .source-category strong {
            display: block;
            margin-bottom: 10px;
            color: #2a5298;
            font-size: 1em;
        }

        .source-category ul {
            margin: 0;
            padding-left: 20px;
        }

        .source-category li {
            padding: 5px 0;
            color: #555;
            font-size: 0.9em;
            border-bottom: none;
        }

        .error-message {
            margin: 20px 40px;
            padding: 16px;
            background: #fee;
            border: 2px solid #fcc;
            border-radius: 8px;
            color: #c33;
            font-weight: 500;
        }

        .results-header {
            padding: 30px 40px;
            background: #f8f9fa;
            border-bottom: 2px solid #e0e0e0;
        }

        .results-header h2 {
            color: #333;
            font-size: 1.8em;
            margin-bottom: 15px;
        }

        .query-info {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
            color: #666;
            font-size: 0.95em;
        }

        .query-info span {
            padding: 6px 12px;
            background: white;
            border-radius: 4px;
            border: 1px solid #e0e0e0;
        }

        .summary-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            padding: 30px 40px;
            background: #f8f9fa;
        }

        .summary-card {
            background: white;
            border-radius: 12px;
            padding: 25px;
            display: flex;
            align-items: center;
            gap: 20px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            transition: transform 0.2s;
        }

        .summary-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }

        .card-icon {
            font-size: 2.5em;
        }

        .card-value {
            font-size: 1.8em;
            font-weight: 700;
            color: #2a5298;
            margin-bottom: 5px;
        }

        .card-label {
            color: #666;
            font-size: 0.9em;
        }

        .tabs {
            display: flex;
            gap: 10px;
            padding: 0 40px;
            border-bottom: 2px solid #e0e0e0;
            background: #f8f9fa;
        }

        .tab-button {
            padding: 15px 30px;
            border: none;
            background: transparent;
            font-size: 1em;
            font-weight: 600;
            color: #666;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            transition: all 0.3s;
        }

        .tab-button:hover {
            color: #2a5298;
        }

        .tab-button.active {
            color: #2a5298;
            border-bottom-color: #2a5298;
        }

        .tab-content {
            display: none;
            padding: 30px 40px;
        }

        .tab-content.active {
            display: block;
        }

        .filters {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .filters select,
        .filters button {
            padding: 10px 16px;
            border: 2px solid #e0e0e0;
            border-radius: 6px;
            font-size: 0.95em;
            background: white;
            cursor: pointer;
            transition: all 0.3s;
        }

        .filters select:focus {
            outline: none;
            border-color: #2a5298;
        }

        .filters button {
            background: #2a5298;
            color: white;
            border-color: #2a5298;
            font-weight: 600;
        }

        .filters button:hover {
            background: #1e3c72;
        }

        .data-table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .data-table thead {
            background: #2a5298;
            color: white;
        }

        .data-table th {
            padding: 15px;
            text-align: left;
            font-weight: 600;
        }

        .data-table td {
            padding: 12px 15px;
            border-bottom: 1px solid #eee;
        }

        .data-table tbody tr:hover {
            background: #f8f9fa;
        }

        .badge {
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 0.85em;
            font-weight: 600;
        }

        .badge.export {
            background: #d4edda;
            color: #155724;
        }

        .badge.import {
            background: #fff3cd;
            color: #856404;
        }

        .stats-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 30px;
        }

        .stat-chart {
            background: white;
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .stat-chart h3 {
            margin-bottom: 20px;
            color: #333;
            border-bottom: 2px solid #eee;
            padding-bottom: 10px;
        }

        .stat-item {
            margin-bottom: 20px;
        }

        .stat-label {
            font-weight: 600;
            color: #555;
            margin-bottom: 8px;
        }

        .stat-bar {
            height: 25px;
            background: #e0e0e0;
            border-radius: 12px;
            overflow: hidden;
            margin-bottom: 8px;
        }

        .stat-bar-fill {
            height: 100%;
            background: linear-gradient(90deg, #1e3c72, #2a5298);
            border-radius: 12px;
            transition: width 0.5s;
        }

        .stat-bar-fill.export {
            background: linear-gradient(90deg, #28a745, #20c997);
        }

        .stat-bar-fill.import {
            background: linear-gradient(90deg, #ffc107, #fd7e14);
        }

        .stat-details {
            display: flex;
            gap: 15px;
            font-size: 0.9em;
            color: #666;
            flex-wrap: wrap;
        }

        .no-data {
            text-align: center;
            padding: 40px;
            color: #999;
            font-size: 1.1em;
        }

        #errorsSection {
            margin: 30px 40px;
            padding: 20px;
            background: #fff3cd;
            border-radius: 8px;
            border-left: 4px solid #ffc107;
        }

        #errorsSection h3 {
            margin-bottom: 15px;
            color: #856404;
        }

        .error-item {
            padding: 8px;
            margin: 5px 0;
            background: white;
            border-radius: 4px;
            color: #856404;
            font-size: 0.9em;
        }

        @media (max-width: 768px) {
            header h1 {
                font-size: 2em;
            }

            .form-row {
                grid-template-columns: 1fr;
            }

            .sources-grid {
                grid-template-columns: 1fr;
            }

            .summary-cards {
                grid-template-columns: 1fr;
            }

            .stats-container {
                grid-template-columns: 1fr;
            }

            .data-table {
                font-size: 0.85em;
            }

            .data-table th,
            .data-table td {
                padding: 8px;
            }

            .filters {
                flex-direction: column;
            }

            .filters select,
            .filters button {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>ğŸŒ å›½é™…è´¸æ˜“æ•°æ®æŸ¥è¯¢ç³»ç»Ÿ</h1>
            <p class="subtitle">é€šè¿‡å•†å“ç¼–ç å’Œå¹´ä»½æŸ¥è¯¢å…¨çƒè´¸æ˜“äº¤æ˜“æ•°æ®</p>
        </header>

        <div class="input-section">
            <form id="queryForm">
                <div class="form-group">
                    <label for="commodity_code">
                        <span class="label-text">å•†å“ç¼–ç  (HSç¼–ç ):</span>
                        <span class="label-hint">è¯·è¾“å…¥6-10ä½æ•°å­—ï¼Œä¾‹å¦‚ï¼š010101</span>
                    </label>
                    <input 
                        type="text" 
                        id="commodity_code" 
                        name="commodity_code" 
                        placeholder="ä¾‹å¦‚ï¼š010101" 
                        pattern="\d{6,10}"
                        maxlength="10"
                        required
                    >
                </div>

                <div class="form-group">
                    <label for="year">
                        <span class="label-text">å¹´ä»½:</span>
                        <span class="label-hint">è¯·è¾“å…¥è¦æŸ¥è¯¢çš„å¹´ä»½</span>
                    </label>
                    <input 
                        type="number" 
                        id="year" 
                        name="year" 
                        placeholder="ä¾‹å¦‚ï¼š2023" 
                        min="1990"
                        max="2024"
                        required
                    >
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="country_from">
                            <span class="label-text">å‡ºå£å›½ (å¯é€‰):</span>
                            <span class="label-hint">ä¾‹å¦‚ï¼šä¸­å›½</span>
                        </label>
                        <input 
                            type="text" 
                            id="country_from" 
                            name="country_from" 
                            placeholder="ä¾‹å¦‚ï¼šä¸­å›½ã€ç¾å›½ã€æ—¥æœ¬" 
                        >
                    </div>

                    <div class="form-group">
                        <label for="country_to">
                            <span class="label-text">è¿›å£å›½ (å¯é€‰):</span>
                            <span class="label-hint">ä¾‹å¦‚ï¼šç¾å›½</span>
                        </label>
                        <input 
                            type="text" 
                            id="country_to" 
                            name="country_to" 
                            placeholder="ä¾‹å¦‚ï¼šç¾å›½ã€å¾·å›½ã€éŸ©å›½" 
                        >
                    </div>
                </div>

                <button type="submit" id="submitBtn">
                    <span id="btnText">ğŸ” æŸ¥è¯¢è´¸æ˜“æ•°æ®</span>
                    <span id="btnLoader" class="loader" style="display: none;"></span>
                </button>
            </form>

            <div class="info-box">
                <h3>ğŸ“‹ æ•°æ®æ¥æºè¯´æ˜</h3>
                <div class="sources-grid">
                    <div class="source-category">
                        <strong>ğŸŒ å›½é™…ç»„ç»‡:</strong>
                        <ul>
                            <li>è”åˆå›½å•†å“è´¸æ˜“ç»Ÿè®¡æ•°æ®åº“ (UN Comtrade)</li>
                            <li>ä¸–ç•Œè´¸æ˜“ç»„ç»‡ (WTO)</li>
                            <li>å›½é™…è´¸æ˜“ä¸­å¿ƒ (ITC)</li>
                        </ul>
                    </div>
                    <div class="source-category">
                        <strong>ğŸ‡¨ğŸ‡³ äºšæ´²åœ°åŒº:</strong>
                        <ul>
                            <li>ä¸­å›½æµ·å…³æ€»ç½²</li>
                            <li>æ—¥æœ¬æµ·å…³</li>
                            <li>éŸ©å›½æµ·å…³</li>
                            <li>å°åº¦å•†åŠ¡éƒ¨</li>
                            <li>ä¸œç›Ÿè´¸æ˜“ç»Ÿè®¡</li>
                            <li>ä¿„ç½—æ–¯æµ·å…³</li>
                        </ul>
                    </div>
                    <div class="source-category">
                        <strong>ğŸ‡ªğŸ‡º æ¬§æ´²åœ°åŒº:</strong>
                        <ul>
                            <li>æ¬§ç›Ÿç»Ÿè®¡å±€</li>
                            <li>è‹±å›½è´¸æ˜“ç»Ÿè®¡å±€</li>
                        </ul>
                    </div>
                    <div class="source-category">
                        <strong>ğŸ‡ºğŸ‡¸ ç¾æ´²åœ°åŒº:</strong>
                        <ul>
                            <li>ç¾å›½äººå£æ™®æŸ¥å±€</li>
                            <li>åŠ æ‹¿å¤§ç»Ÿè®¡å±€</li>
                            <li>å·´è¥¿å‘å±•å·¥ä¸šå¤–è´¸éƒ¨</li>
                        </ul>
                    </div>
                    <div class="source-category">
                        <strong>ğŸ‡¦ğŸ‡º å¤§æ´‹æ´²:</strong>
                        <ul>
                            <li>æ¾³å¤§åˆ©äºšç»Ÿè®¡å±€</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>

        <div id="errorMessage" class="error-message" style="display: none;"></div>

        <div id="resultsSection" style="display: none;">
            <div class="results-header">
                <h2>æŸ¥è¯¢ç»“æœ</h2>
                <div class="query-info" id="queryInfo"></div>
            </div>

            <div class="summary-cards" id="summaryCards"></div>

            <div class="tabs">
                <button class="tab-button active" onclick="showTab('details')">è¯¦ç»†æ•°æ®</button>
                <button class="tab-button" onclick="showTab('statistics')">ç»Ÿè®¡åˆ†æ</button>
            </div>

            <div id="detailsTab" class="tab-content active">
                <div class="filters">
                    <select id="filterTradeType">
                        <option value="all">å…¨éƒ¨ç±»å‹</option>
                        <option value="å‡ºå£">ä»…å‡ºå£</option>
                        <option value="è¿›å£">ä»…è¿›å£</option>
                    </select>
                    <select id="filterSource">
                        <option value="all">å…¨éƒ¨æ¥æº</option>
                    </select>
                    <button onclick="applyFilters()">ç­›é€‰</button>
                    <button onclick="resetFilters()">é‡ç½®</button>
                </div>
                <div id="dataTableContainer"></div>
            </div>

            <div id="statisticsTab" class="tab-content">
                <div class="stats-container">
                    <div class="stat-chart">
                        <h3>æŒ‰å›½å®¶ç»Ÿè®¡</h3>
                        <div id="countryStats"></div>
                    </div>
                    <div class="stat-chart">
                        <h3>æŒ‰äº¤æ˜“ç±»å‹ç»Ÿè®¡</h3>
                        <div id="tradeTypeStats"></div>
                    </div>
                </div>
            </div>

            <div id="errorsSection" style="display: none;">
                <h3>âš ï¸ æ•°æ®æºé”™è¯¯</h3>
                <div id="errorsList"></div>
            </div>
        </div>
    </div>

    <script>
        let allData = [];
        let filteredData = [];

        const form = document.getElementById('queryForm');
        const submitBtn = document.getElementById('submitBtn');
        const btnText = document.getElementById('btnText');
        const btnLoader = document.getElementById('btnLoader');
        const errorMessage = document.getElementById('errorMessage');
        const resultsSection = document.getElementById('resultsSection');
        const dataTableContainer = document.getElementById('dataTableContainer');
        const summaryCards = document.getElementById('summaryCards');
        const queryInfo = document.getElementById('queryInfo');

        form.addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const commodityCode = document.getElementById('commodity_code').value;
            const year = document.getElementById('year').value;
            const countryFrom = document.getElementById('country_from').value.trim();
            const countryTo = document.getElementById('country_to').value.trim();

            submitBtn.disabled = true;
            btnText.style.display = 'none';
            btnLoader.style.display = 'inline-block';
            errorMessage.style.display = 'none';
            resultsSection.style.display = 'none';

            try {
                const requestData = {
                    commodity_code: commodityCode,
                    year: year
                };
                
                if (countryFrom) {
                    requestData.country_from = countryFrom;
                }
                if (countryTo) {
                    requestData.country_to = countryTo;
                }

                const response = await fetch('/api/query', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(requestData)
                });

                const data = await response.json();

                if (!response.ok) {
                    throw new Error(data.error || 'æŸ¥è¯¢å¤±è´¥');
                }

                allData = data.data || [];
                filteredData = [...allData];

                displayResults(data);

            } catch (error) {
                errorMessage.textContent = `é”™è¯¯: ${error.message}`;
                errorMessage.style.display = 'block';
            } finally {
                submitBtn.disabled = false;
                btnText.style.display = 'inline';
                btnLoader.style.display = 'none';
            }
        });

        function displayResults(data) {
            let queryInfoHtml = `
                <span>å•†å“ç¼–ç : <strong>${data.commodity_code}</strong></span>
                <span>å¹´ä»½: <strong>${data.year}</strong></span>
            `;
            if (data.country_from) {
                queryInfoHtml += `<span>å‡ºå£å›½: <strong>${data.country_from}</strong></span>`;
            }
            if (data.country_to) {
                queryInfoHtml += `<span>è¿›å£å›½: <strong>${data.country_to}</strong></span>`;
            }
            queryInfoHtml += `<span>æŸ¥è¯¢æ—¶é—´: ${data.query_time}</span>`;
            queryInfo.innerHTML = queryInfoHtml;

            const summary = data.summary;
            summaryCards.innerHTML = `
                <div class="summary-card">
                    <div class="card-icon">ğŸ“Š</div>
                    <div class="card-content">
                        <div class="card-value">${summary.total_records}</div>
                        <div class="card-label">äº¤æ˜“è®°å½•æ•°</div>
                    </div>
                </div>
                <div class="summary-card">
                    <div class="card-icon">ğŸ“¦</div>
                    <div class="card-content">
                        <div class="card-value">${formatNumber(summary.total_quantity)}</div>
                        <div class="card-label">æ€»æ•°é‡ (åƒå…‹)</div>
                    </div>
                </div>
                <div class="summary-card">
                    <div class="card-icon">ğŸ’°</div>
                    <div class="card-content">
                        <div class="card-value">$${formatNumber(summary.total_value_usd)}</div>
                        <div class="card-label">æ€»ä»·å€¼ (USD)</div>
                    </div>
                </div>
                <div class="summary-card">
                    <div class="card-icon">ğŸŒ</div>
                    <div class="card-content">
                        <div class="card-value">${summary.sources_count}</div>
                        <div class="card-label">æ•°æ®æºæ•°é‡</div>
                    </div>
                </div>
            `;

            displayDataTable(filteredData);
            updateFilterOptions(data);
            displayStatistics(data.statistics);

            if (data.errors && data.errors.length > 0) {
                const errorsSection = document.getElementById('errorsSection');
                const errorsList = document.getElementById('errorsList');
                errorsList.innerHTML = data.errors.map(err => `<div class="error-item">${err}</div>`).join('');
                errorsSection.style.display = 'block';
            }

            resultsSection.style.display = 'block';
        }

        function displayDataTable(data) {
            if (data.length === 0) {
                dataTableContainer.innerHTML = '<div class="no-data">æ²¡æœ‰ç¬¦åˆæ¡ä»¶çš„æ•°æ®</div>';
                return;
            }

            const table = `
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>åºå·</th>
                            <th>æ•°æ®æº</th>
                            <th>äº¤æ˜“ç±»å‹</th>
                            <th>æ•°é‡</th>
                            <th>å•ä½</th>
                            <th>ä»·å€¼ (USD)</th>
                            <th>å‡ºå£å›½</th>
                            <th>è¿›å£å›½</th>
                            <th>æ—¥æœŸ</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${data.map((record, index) => `
                            <tr>
                                <td>${index + 1}</td>
                                <td>${record.source}</td>
                                <td><span class="badge ${record.trade_type === 'å‡ºå£' ? 'export' : 'import'}">${record.trade_type}</span></td>
                                <td>${formatNumber(record.quantity)}</td>
                                <td>${record.unit || 'åƒå…‹'}</td>
                                <td>$${formatNumber(record.value_usd || 0)}</td>
                                <td>${record.country_from}</td>
                                <td>${record.country_to}</td>
                                <td>${record.date}</td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            `;

            dataTableContainer.innerHTML = table;
        }

        function displayStatistics(stats) {
            const countryStatsHtml = Object.entries(stats.by_country || {})
                .map(([country, data]) => `
                    <div class="stat-item">
                        <div class="stat-label">${country}</div>
                        <div class="stat-bar">
                            <div class="stat-bar-fill" style="width: ${(data.quantity / Math.max(...Object.values(stats.by_country).map(d => d.quantity))) * 100}%"></div>
                        </div>
                        <div class="stat-details">
                            <span>æ•°é‡: ${formatNumber(data.quantity)} åƒå…‹</span>
                            <span>ä»·å€¼: $${formatNumber(data.value)}</span>
                            <span>è®°å½•: ${data.count} æ¡</span>
                        </div>
                    </div>
                `).join('');

            document.getElementById('countryStats').innerHTML = countryStatsHtml || '<div class="no-data">æš‚æ— æ•°æ®</div>';

            const tradeTypeStatsHtml = Object.entries(stats.by_trade_type || {})
                .map(([type, data]) => `
                    <div class="stat-item">
                        <div class="stat-label">${type}</div>
                        <div class="stat-bar">
                            <div class="stat-bar-fill ${type === 'å‡ºå£' ? 'export' : 'import'}" style="width: ${(data.quantity / Math.max(...Object.values(stats.by_trade_type).map(d => d.quantity))) * 100}%"></div>
                        </div>
                        <div class="stat-details">
                            <span>æ•°é‡: ${formatNumber(data.quantity)} åƒå…‹</span>
                            <span>ä»·å€¼: $${formatNumber(data.value)}</span>
                            <span>è®°å½•: ${data.count} æ¡</span>
                        </div>
                    </div>
                `).join('');

            document.getElementById('tradeTypeStats').innerHTML = tradeTypeStatsHtml || '<div class="no-data">æš‚æ— æ•°æ®</div>';
        }

        function updateFilterOptions(data) {
            const filterSource = document.getElementById('filterSource');
            const sources = [...new Set(data.data.map(r => r.source))];
            filterSource.innerHTML = '<option value="all">å…¨éƒ¨æ¥æº</option>' + 
                sources.map(src => `<option value="${src}">${src}</option>`).join('');
        }

        function applyFilters() {
            const tradeType = document.getElementById('filterTradeType').value;
            const source = document.getElementById('filterSource').value;

            filteredData = allData.filter(record => {
                const matchTradeType = tradeType === 'all' || record.trade_type === tradeType;
                const matchSource = source === 'all' || record.source === source;
                return matchTradeType && matchSource;
            });

            displayDataTable(filteredData);
        }

        function resetFilters() {
            document.getElementById('filterTradeType').value = 'all';
            document.getElementById('filterSource').value = 'all';
            filteredData = [...allData];
            displayDataTable(filteredData);
        }

        function showTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.tab-button').forEach(btn => {
                btn.classList.remove('active');
            });

            if (tabName === 'details') {
                document.getElementById('detailsTab').classList.add('active');
                document.querySelector('.tab-button:first-child').classList.add('active');
            } else {
                document.getElementById('statisticsTab').classList.add('active');
                document.querySelector('.tab-button:last-child').classList.add('active');
            }
        }

        function formatNumber(num) {
            if (num >= 1000000) {
                return (num / 1000000).toFixed(2) + 'M';
            } else if (num >= 1000) {
                return (num / 1000).toFixed(2) + 'K';
            }
            return num.toLocaleString();
        }
    </script>
</body>
</html>
